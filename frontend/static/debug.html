<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Backend Debug Console</title>
<style>
	* { margin: 0; padding: 0; box-sizing: border-box; }
	html, body { height: 100%; background: #0c0c0c; color: #cccccc; font-family: 'Cascadia Mono', 'Consolas', 'Courier New', monospace; font-size: 14px; }
	#toolbar { background: #1e1e1e; border-bottom: 1px solid #333; padding: 4px 8px; display: flex; align-items: center; gap: 8px; user-select: none; }
	#toolbar button { background: #333; color: #ccc; border: 1px solid #555; border-radius: 3px; padding: 2px 10px; cursor: pointer; font-size: 12px; }
	#toolbar button:hover { background: #444; }
	#toolbar .status { margin-left: auto; font-size: 12px; color: #888; }
	#output { height: calc(100% - 30px); overflow-y: auto; padding: 8px; white-space: pre-wrap; word-break: break-all; line-height: 1.4; }
	.stderr { color: #f48771; }
	.stdout { color: #cccccc; }
</style>
</head>
<body>
<div id="toolbar">
	<button id="clearBtn">Clear</button>
	<button id="scrollBtn">Auto-scroll: ON</button>
	<span class="status" id="status">Waiting for backend...</span>
</div>
<div id="output"></div>
<script>
(async () => {
	const output = document.getElementById('output');
	const status = document.getElementById('status');
	const clearBtn = document.getElementById('clearBtn');
	const scrollBtn = document.getElementById('scrollBtn');
	let autoScroll = true;
	let lineCount = 0;

	clearBtn.addEventListener('click', () => {
		output.innerHTML = '';
		lineCount = 0;
		status.textContent = 'Cleared';
	});

	scrollBtn.addEventListener('click', () => {
		autoScroll = !autoScroll;
		scrollBtn.textContent = 'Auto-scroll: ' + (autoScroll ? 'ON' : 'OFF');
	});

	function appendLine(text, isErr) {
		const span = document.createElement('span');
		span.className = isErr ? 'stderr' : 'stdout';
		span.textContent = text + '\n';
		output.appendChild(span);
		lineCount++;
		if (autoScroll) output.scrollTop = output.scrollHeight;
		status.textContent = lineCount + ' lines';
	}

	// Wait for Tauri global API to be injected
	function waitForTauri() {
		return new Promise((resolve) => {
			if (window.__TAURI__) return resolve(window.__TAURI__);
			const check = setInterval(() => {
				if (window.__TAURI__) { clearInterval(check); resolve(window.__TAURI__); }
			}, 10);
		});
	}

	const TAURI = await waitForTauri();
	const { listen } = TAURI.event;

	await listen('backend-stdout', (e) => appendLine(e.payload, false));
	await listen('backend-stderr', (e) => appendLine(e.payload, true));

	status.textContent = 'Connected, waiting for output...';
})();
</script>
</body>
</html>
